<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Fashion Assistant</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      background-color: #f8f9fa; 
    }
    main {
      flex: 1; 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }


    #typingIndicator {
      display: none;
      font-style: italic;
      color: gray;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #394149;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html" style="color: #F5F5DC;">
        ⬅ Back to Store
      </a>
      <div class="ms-auto">
        <a href="products.html" class="fw-bold" style="color: #F5F5DC; text-decoration: none;">
          ⬅ Check Out Products
        </a>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <main>
    <div class="container d-flex flex-column align-items-center mt-5">
      <div class="card shadow-lg rounded-4 p-4" style="max-width:600px; width:100%;">
        <h3 class="text-center mb-3">AI Fashion Assistant</h3>

        <div id="chatBox" class="d-flex flex-column overflow-auto mb-2 p-2 border rounded" style="max-height:400px;"></div>

        <!-- Typing Indicator -->
        <div id="typingIndicator" class="mb-2">AI is typing...</div>
        
        <div class="d-flex gap-2">
          <input type="text" id="userInput" class="form-control" placeholder="Ask me anything about fashion..." />
          <button id="sendBtn" class="btn btn-dark">Send</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-light py-4" style="background-color: #2c3e50; color: #F5F5DC;">
    <div class="container text-center" style="background-color: #394149;">
      <p class="mb-1">&copy; 2025 My Shop. All rights reserved.</p>
      <small>Made with ❤ using MongoDB + Express + Node.js</small>
    </div>
  </footer>
<script>

  const chatBox = document.getElementById("chatBox");      
  const userInput = document.getElementById("userInput");   
  const sendBtn = document.getElementById("sendBtn");       
  const typingIndicator = document.getElementById("typingIndicator"); // showing typing 

  // Function to append a message to the chat box
  function appendMessage(text, sender) {
    const msg = document.createElement("div"); // Create a new message element (div)

    // Apply different styling depending on sender (user or bot)
    msg.className = sender === "user"
      ? "bg-success-subtle text-dark p-2 align-self-end mb-1"
      : "bg-danger-subtle text-dark p-2 align-self-start mb-1"; 

    msg.textContent = text;         // Put the actual text inside the message
    chatBox.appendChild(msg);       // Add the message to the chat box
    chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the bottom
  }

  // Function to send the user’s message to the server
  async function sendMessage() {
    const text = userInput.value.trim(); // Get user input and remove extra spaces
    if (!text) return; // If input is empty, do nothing

    appendMessage(text, "user");  // Show the user's message in the chat box
    userInput.value = "";         // Clear the input box

    typingIndicator.style.display = "block"; // Show "typing..." while waiting for AI

    try {
      // Send message to backend API (your AI endpoint)
      const res = await fetch("/fashion/ai/gemini", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text }) // Send message as JSON
      });

      // Parse the server response (AI reply)
      const data = await res.json();
      typingIndicator.style.display = "none"; // Hide typing indicator

      // Display AI response, or fallback message if none
      appendMessage(data.reply || "No response from AI", "bot");
    } catch (err) {
      // Handle errors (e.g., server down, network issues)
      console.error(err);
      typingIndicator.style.display = "none";
      appendMessage("Error contacting AI", "bot");
    }
  }

  // Event listener: when "Send" button is clicked
  sendBtn.addEventListener("click", sendMessage);

  // Event listener: allow pressing Enter key to send message
  userInput.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
